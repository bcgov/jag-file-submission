version: "3.7"
services:
  
  # Application Service are located in docker-compose.override.yml

  #############################################################################################
  ###                                 REDIS SERVER                                          ###
  #############################################################################################
  redis:
    container_name: redis
    image: redis
    command: redis-server --requirepass admin
    ports:
      - "6379:6379"
    volumes:
      - data-redis:/data
    restart: always
    networks:
      - fisu-net

  #############################################################################################
  ###                                 REDIS COMMANDER                                       ###
  #############################################################################################
  redis-commander:
    container_name: redis-commander
    hostname: redis-commander
    image: rediscommander/redis-commander:latest
    restart: always
    environment:
      - REDIS_PORT=6379
      - REDIS_HOST=redis
      - REDIS_PASSWORD=admin
    ports:
      - "8082:8081"
    networks:
      - fisu-net

  # #############################################################################################
  # ###                                        KEYCLOAK                                       ###
  # #############################################################################################
  keycloak:
    image: quay.io/keycloak/keycloak
    environment:
      DB_VENDOR: H2
      KEYCLOAK_USER: admin
      KEYCLOAK_PASSWORD: admin
      KEYCLOAK_IMPORT: /tmp/realm-export.json
      KEYCLOAK_FRONTEND_URL: http://localhost:8081/auth
    volumes:
      - ./infrastructure/keycloak/realm-export.json:/tmp/realm-export.json
    ports:
      - 8081:8080
    networks:
      - fisu-net

  #############################################################################################
  ###                             CLAMAV                                                    ###
  #############################################################################################
  clamav:
    image: mk0x/docker-clamav
    ports:
      - "3310:3310"
    networks:
      - fisu-net

  #############################################################################################
  ###                             skywalking-oap-server                                     ###
  #############################################################################################
  skywalking-oap-server:
    image: apache/skywalking-oap-server:8.4.0-es7
    container_name: skywalking-oap-server
    restart: always
    ports:
      - 11800:11800
      - 12800:12800
    environment:
      SW_HEALTH_CHECKER: default
    networks:
      - fisu-net
  
  #############################################################################################
  ###                             skywalking-ui                                              ###
  #############################################################################################
  skywalking-ui:
    image: apache/skywalking-ui:8.4.0
    container_name: skywalking-ui
    depends_on:
      - skywalking-oap-server
    links:
      - skywalking-oap-server
    restart: always
    ports:
      - 8070:8080
    environment:
      SW_OAP_ADDRESS: skywalking-oap-server:12800
    networks:
      - fisu-net

volumes:
  data-redis:
    driver: local

networks:
  fisu-net:
    driver: "bridge"
